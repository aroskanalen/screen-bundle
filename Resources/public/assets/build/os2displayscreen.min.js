/**
 * @name os2display screen-bundle
 * @version v1.0.0
 * @link https://github.com/os2display/screen-bundle
 */
angular.module("screenApp").config(["$translateProvider",function(e){"use strict";e.useSanitizeValueStrategy("escape").useStaticFilesLoader({prefix:"bundles/os2displayscreen/apps/screenApp/translations/locale-",suffix:".json"}).preferredLanguage("da").fallbackLanguage("da").forceAsyncReload(!0)}]),angular.module("screenApp").service("screenAppSetup",["busService","userService","$translate","$filter","$http","$timeout",function(i,e,c,n,a,r){"use strict";function d(n){n.scope.hasOwnProperty("screenBundleOpenPreview")||(n.scope.screenBundleOpenPreview=function(e){n.scope.screenBundleShowPreview=e},n.scope.screenBundleClosePreview=function(){r(function(){n.scope.$apply(function(){n.scope.screenBundleShowPreview=null})})})}i.$on("itkHeader.list.element.requestItems",function(e,t){if(t&&("screen"===t.type||"channel"===t.type)){d(t);var n='  <div tooltips tooltip-template="'+c.instant("screen.app.start_preview")+'" tooltip-side="top">    <a ng-click="screenBundleOpenPreview('+t.entity.id+')" class="os2display-screen-bundle--play-icon-active">       <img class="os2display-screen-bundle--play-icon" src="bundles/os2displayscreen/assets/icons/play.svg"/>    </a>  </div>',l="/screen/display"+("channel"===t.type?"_channel":"")+"/"+t.entity.id;n=n+'<span data-ng-if="screenBundleShowPreview === '+t.entity.id+'"><screen-bundle-preview preview-url="'+l+'" close="screenBundleClosePreview()"></screen-bundle-preview></span></div>',i.$emit(t.returnEvent,{html:n}),a.get("/screen/api/publicly_available"+("channel"===t.type?"_channel":"")+"/"+t.entity.id).then(function(e){if(e.data.enabled){var n='  <div tooltips tooltip-template="'+c.instant("screen.app.public")+'" tooltip-side="top">    <div class="os2display-screen-bundle--icon-container"><img class="os2display-screen-bundle--unlocked-icon" src="bundles/os2displayscreen/assets/icons/public.svg"></div>  </div>';i.$emit(t.returnEvent,{html:n})}})}}),i.$on("itkHeader.settings.extra-fields.requestItems",function(e,n){if("screen"===n.type||"channel"===n.type){n.scope.screenBundlePublicUrl=null,n.scope.screenBundlePublicEnabled=null;var t="",l="/screen/display"+("channel"===n.type?"_channel":"")+"/"+n.entity.id;t="screen"===n.type?"/screen/api/publicly_available/"+n.entity.id:"/screen/api/publicly_available_channel/"+n.entity.id,a.get(t).then(function(e){r(function(){n.scope.$apply(function(){n.scope.screenBundlePublicUrl=e.data.publicUrl,n.scope.screenBundlePublicEnabled=e.data.enabled})})},function(e){404!==e.status&&console.log(e)}),n.scope.hasOwnProperty("screenBundleTogglePublicAvailable")||(n.scope.screenBundleTogglePublicAvailable=function(){a.post(t,{enabled:!n.scope.screenBundlePublicEnabled}).then(function(e){r(function(){n.scope.$apply(function(){n.scope.screenBundlePublicUrl=e.data.publicUrl,n.scope.screenBundlePublicEnabled=e.data.enabled})})},function(e){404!==e.status&&console.log(e)})}),d(n);var s='<form class="cpw--wrapper" data-info="From: screen-bundle"><div class="cpw--text"><label class="cpw--text-label">'+c.instant("screen.extra_fields.preview")+'</label><button class="cpw--add-channels-item-action os2display-screen-bundle--extra-fields-button" data-ng-click="screenBundleOpenPreview('+n.entity.id+')">'+c.instant("screen.extra_fields.preview_button")+'</button><p class="os2display-screen-bundle--preview-button-text">'+c.instant("screen.extra_fields.preview_text")+'</p><span data-ng-if="screenBundleShowPreview === '+n.entity.id+'"><screen-bundle-preview preview-url="'+l+'" close="screenBundleClosePreview()"></screen-bundle-preview></span></div><div class="cpw--text"><label class="cpw--text-label">'+c.instant("screen.extra_fields.publicly_available")+'</label><button data-ng-click="screenBundleTogglePublicAvailable()" class="os2display-screen-bundle--extra-fields-button" data-ng-class="{\'cpw--add-channels-item-action\': !screenBundlePublicEnabled, \'cpw--selected-channels-item-action\': screenBundlePublicEnabled}"><span data-ng-if="screenBundlePublicEnabled">'+c.instant("screen.extra_fields.publicly_available_toggle_enabled")+'</span><span data-ng-if="!screenBundlePublicEnabled">'+c.instant("screen.extra_fields.publicly_available_toggle_disabled")+'</span></button></div><div class="cpw--text" data-ng-if="screenBundlePublicEnabled && screenBundlePublicUrl"><label class="cpw--text-label">'+c.instant("screen.extra_fields.public_url")+'</label><textarea type="text" class="cpw--text-input" readonly="readonly" data-ng-model="screenBundlePublicUrl"></div></form>';i.$emit(n.returnEvent,{html:s})}})}]),angular.module("screenApp").directive("screenBundlePreview",["$timeout","busService",function(i,c){return{restrict:"E",replace:!0,scope:{previewUrl:"@",close:"&"},link:function(e,n,t){var l;function s(){i(function(){e.selectedAspectRatio.w>e.selectedAspectRatio.h?(e.width=Math.min(l,1200),e.height=e.width/e.selectedAspectRatio.w*e.selectedAspectRatio.h):(e.width=Math.min(l,1200*e.selectedAspectRatio.w/e.selectedAspectRatio.h),e.height=e.width*e.selectedAspectRatio.h/e.selectedAspectRatio.w)})}c.$emit("bodyService.addClass","is-locked"),e.aspectRatios=[{id:0,w:16,h:9,name:"16:9 (Full HD)"},{id:1,w:9,h:16,name:"9:16 (Full HD portrait)"}],e.selectedAspectRatio=e.aspectRatios[0],n.ready(function(){i(function(){l=Math.min(n[0].offsetWidth-40),s()})}),e.$watch("selectedAspectRatio",function(){s()}),e.$on("$destroy",function(){c.$emit("bodyService.removeClass","is-locked")})},templateUrl:"/bundles/os2displayscreen/apps/screenApp/preview/preview.html"}}]);